{% extends 'services/base.html' %}
{% load static %}

{% block content %}

<header class="pt-5" xmlns="http://www.w3.org/1999/html"></header>
    <section>
        <div class="container py-4 py-xl-5" style="margin-top: 30px" >
            <form method="post">
                {% csrf_token %}
                <h1 style="text-align: right; margin: 20px 40px">{{ structure.name }}. <br>Отчеты</h1>

                <div class="row" style="margin-top: 10px;margin-bottom: 10px;">
                    <div class="col text-end"><label class="col-form-label fw-bold text-end">Выберите месяц:</label></div>
                    <div class="col"><input class="form-control" type="month" name="month" required/></div>
                    <div class="col"><input class="btn btn-primary" type="submit" value="Показать"/><a class="btn btn-success" style="margin-left: 10px">Показать все</a></div>
                </div>
                <div class="table-responsive" style="margin-top: 10px;margin-bottom: 10px;">
                    <div class="table-responsive" style="margin-top: 10px;margin-bottom: 10px;">
                        <table class="table table-striped table-bordered">
                            <thead>
                                <tr>
                                    <th class="text-center" style="width: 15%;">Дата</th>
                                    <th class="text-center">Услуга</th>
                                    <th class="text-center" style="width: 15%;">Количество</th>
                                    <th class="text-center" style="width: 23%;">Сумма</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for r in reports %}
                                    <tr>
                                        <td class="text-center">{{ r.date }}</td>
                                        <td class="text-center">{{ r.service }}</td>
                                        <td class="text-center">{{ r.amount }}</td>
                                        <td class="text-center">{{ r.sum }} руб.</td>
                                    </tr>
                                {% endfor %}
                            </tbody>
                            <tfoot class="table-group-divider">
                                <tr>
                                    <td class="fw-bold text-end"></td>
                                    <td class="text-end"><strong>Итого</strong></td>
                                    <td class="fw-bold text-center" style="padding-right: 22px;" id="total_count"></td>
                                    <td class="fw-bold text-center" id="total_sum"></td>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                </div>
            </form>
        </div>
    </section>
<!--https://www.schoolsw3.com/howto/howto_js_filter_table.php-->
<script>
        window.onload = function Sum() {

            const
                total_count = document.getElementById('total_count'),
                total_sum = document.getElementById('total_sum');

            let trs = document.getElementsByTagName('tbody')[0].getElementsByTagName('tr');
            tc=0;
            ts=0;
            for (let td=0; td < trs.length; td++){
                tc = tc + Number(trs[td].getElementsByTagName('td')[2].innerText);
                total_count.innerText = tc;

                ts = ts + parseFloat(trs[td].getElementsByTagName('td')[3].innerText.split(' ')[0].replace(',', '.'))
                total_sum.innerText = ts.toFixed(2).replace('.', ',') + ' руб.';
            }
        }
</script>

{% endblock %}