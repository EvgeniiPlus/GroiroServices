{% extends 'services/base.html' %}
{% load static %}

{% block content %}

<header class="pt-5" xmlns="http://www.w3.org/1999/html"></header>
    <section>
        <div class="container py-4 py-xl-5">
            <h1 style="text-align: right; margin: 20px 40px">Просмотр отчета</h1>
            <form method="post">
                {% csrf_token %}
                <label class="form-label fw-bold">Выберите дату: </label>
                <input class="form-control fw-bold" type="date" name="service_date" value="{{ current_date|date:'Y-m-d' }}" required="">
                <div class="table-responsive" style="margin-top: 10px;margin-bottom: 10px;">
                        <table id="calc_services" class="table table-striped table-striped-columns table-bordered">
                            <tbody>
                                    {% for s in structures %}
                                        <tr>
                                            <td name="service_name">{{ s.name }}</td>
                                        </tr>
                                    {% endfor %}
                            </tbody>
                        </table>
                </div>
                <input class="btn btn-primary" type="submit">
            </form>
        </div>
    </section>


    <script>
        function Sum(ths, price) {
            const tr = ths.parentNode.parentNode,
                count = tr.getElementsByTagName('input')[0].value,
                sum = Number(count)*parseFloat(price.replace(',', '.')),
                total_count = document.getElementById('total_count'),
                total_sum = document.getElementById('total_sum');
            tr.getElementsByTagName('td')[3].innerText = sum.toFixed(2).replace('.', ',') + ' руб.';

            let trs = document.getElementsByTagName('tbody')[0].getElementsByTagName('tr');
            tc=0;
            ts=0;
            for (let td=0; td < trs.length; td++){
                tc = tc + Number(trs[td].getElementsByTagName('input')[0].value);
                total_count.innerText = tc;

                ts = ts + parseFloat(trs[td].getElementsByTagName('td')[3].innerText.split(' ')[0].replace(',', '.'))
                total_sum.innerText = ts.toFixed(2).replace('.', ',') + ' руб.';
            }
        }
        // https://javascript.ru/forum/dom-window/34306-poluchit-znachenie-yacheek-opredelennojj-stroki-tablicy.html
    </script>
{% endblock %}